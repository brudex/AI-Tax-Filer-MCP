<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRA Tax Processor - AI Tax Document Processing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .status-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #28a745;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .status-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .status-label {
            font-weight: bold;
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 1.1rem;
            color: #28a745;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #2980b9;
            background: #e3f2fd;
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: #d4edda;
        }

        .upload-icon {
            font-size: 3rem;
            color: #3498db;
            margin-bottom: 15px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #17a2b8;
        }

        .results h3 {
            color: #495057;
            margin-bottom: 15px;
        }

        .results pre {
            background: white;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            white-space: pre-wrap;
            border: 1px solid #e9ecef;
            max-height: 400px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è GRA Tax Processor</h1>
            <p>AI-Powered Tax Document Processing for Ghana Revenue Authority</p>
        </div>

        <div class="content">
            <!-- Status Panel -->
            <div class="status-panel">
                <h3>üöÄ System Status</h3>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Server Status</div>
                        <div class="status-value" id="serverStatus">Loading...</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">AI Providers</div>
                        <div class="status-value" id="aiProviders">Loading...</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Memory Usage</div>
                        <div class="status-value" id="memoryUsage">Loading...</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Uptime</div>
                        <div class="status-value" id="uptime">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab(event, 'upload')">üìÑ Process Document</button>
                <button class="tab" onclick="switchTab(event, 'report')">üìä Generate Report</button>
                <button class="tab" onclick="switchTab(event, 'test')">üîß Test API</button>
            </div>

            <!-- Upload Tab -->
            <div id="upload" class="tab-content active">
                <h3>Process Tax Document</h3>
                <p>Upload a tax document (PDF, DOCX, Excel, CSV) to extract financial data using AI.</p>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÅ</div>
                    <h4>Drop your document here or click to browse</h4>
                    <p>Supported formats: PDF, DOCX, XLSX, XLS, CSV (Max 10MB)</p>
                    <input type="file" id="fileInput" accept=".pdf,.docx,.xlsx,.xls,.csv" style="display: none;">
                </div>

                <div class="form-group">
                    <label class="form-label" for="context">Additional Context (Optional)</label>
                    <textarea id="context" class="form-control" rows="3" placeholder="Provide any additional context about the document..."></textarea>
                </div>

                <button class="btn" onclick="validateDocument()" id="validateBtn" disabled>
                    üîç Validate Document
                </button>
                <button class="btn btn-success" onclick="processDocument()" id="processBtn" disabled>
                    ü§ñ Process with AI
                </button>

                <div id="uploadResults"></div>
            </div>

            <!-- Report Tab -->
            <div id="report" class="tab-content">
                <h3>Generate Annual Report</h3>
                <p>Generate a comprehensive annual financial report from tax data.</p>
                
                <div class="grid">
                    <div class="form-group">
                        <label class="form-label" for="taxpayerName">Taxpayer Name</label>
                        <input type="text" id="taxpayerName" class="form-control" placeholder="Company Name Ltd">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="taxYear">Tax Year</label>
                        <input type="number" id="taxYear" class="form-control" placeholder="2023" value="2023">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="totalIncome">Total Income ($)</label>
                        <input type="number" id="totalIncome" class="form-control" placeholder="1000000">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="totalExpenses">Total Expenses ($)</label>
                        <input type="number" id="totalExpenses" class="form-control" placeholder="500000">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="totalDeductions">Total Deductions ($)</label>
                        <input type="number" id="totalDeductions" class="form-control" placeholder="50000">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="taxableAmount">Taxable Amount ($)</label>
                        <input type="number" id="taxableAmount" class="form-control" placeholder="450000">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="taxId">Tax ID/TIN</label>
                        <input type="text" id="taxId" class="form-control" placeholder="C001234567">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="businessType">Business Type</label>
                        <input type="text" id="businessType" class="form-control" placeholder="Technology Services">
                    </div>
                </div>

                <button class="btn btn-success" onclick="generateReport()">
                    üìã Generate Annual Report
                </button>

                <div id="reportResults"></div>
            </div>

            <!-- Test Tab -->
            <div id="test" class="tab-content">
                <h3>API Testing</h3>
                <p>Test various API endpoints to verify functionality.</p>
                
                <button class="btn" onclick="testConnection()">üîó Test Connection</button>
                <button class="btn" onclick="checkAIStatus()">ü§ñ Check AI Status</button>
                <button class="btn" onclick="getServerStatus()">üìä Server Status</button>

                <div id="testResults"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001';
        let selectedFile = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            setupFileUpload();
        });

        // Load system status
        async function loadSystemStatus() {
            try {
                const [statusRes, aiRes] = await Promise.all([
                    fetch(`${API_BASE}/api/status`),
                    fetch(`${API_BASE}/api/ai-status`)
                ]);

                const status = await statusRes.json();
                const aiStatus = await aiRes.json();

                if (status.success) {
                    document.getElementById('serverStatus').textContent = status.data.status;
                    document.getElementById('memoryUsage').textContent = status.data.memory.used;
                    document.getElementById('uptime').textContent = status.data.uptime;
                }

                if (aiStatus.success) {
                    document.getElementById('aiProviders').textContent = 
                        `${aiStatus.data.availableProviders.length} active (${aiStatus.data.availableProviders.join(', ')})`;
                }
            } catch (error) {
                console.error('Failed to load status:', error);
                document.getElementById('serverStatus').textContent = 'Error - Server not running?';
                document.getElementById('aiProviders').textContent = 'Error';
                document.getElementById('memoryUsage').textContent = 'Error';
                document.getElementById('uptime').textContent = 'Error';
            }
        }

        // Setup file upload
        function setupFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelect(file) {
            selectedFile = file;
            document.getElementById('uploadArea').innerHTML = `
                <div class="upload-icon">‚úÖ</div>
                <h4>${file.name}</h4>
                <p>Size: ${(file.size / 1024).toFixed(2)} KB</p>
            `;
            document.getElementById('validateBtn').disabled = false;
            document.getElementById('processBtn').disabled = false;
        }

        // Switch tabs
        function switchTab(event, tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Validate document
        async function validateDocument() {
            if (!selectedFile) return;

            showLoading('uploadResults');
            
            const formData = new FormData();
            formData.append('document', selectedFile);

            try {
                const response = await fetch(`${API_BASE}/api/validate-document`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                showResults('uploadResults', result, 'Document Validation');
            } catch (error) {
                showError('uploadResults', error.message);
            }
        }

        // Process document
        async function processDocument() {
            if (!selectedFile) return;

            showLoading('uploadResults');
            
            const formData = new FormData();
            formData.append('document', selectedFile);
            formData.append('context', document.getElementById('context').value);

            try {
                const response = await fetch(`${API_BASE}/api/process-document`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                showResults('uploadResults', result, 'Document Processing');
                
                // Auto-fill report form if successful
                if (result.success && result.data.extractedData) {
                    const data = result.data.extractedData;
                    document.getElementById('taxpayerName').value = data.taxpayerName || '';
                    document.getElementById('taxYear').value = data.taxYear || 2023;
                    document.getElementById('totalIncome').value = data.financialSummary.totalIncome || '';
                    document.getElementById('totalExpenses').value = data.financialSummary.totalExpenses || '';
                    document.getElementById('totalDeductions').value = data.financialSummary.totalDeductions || '';
                    document.getElementById('taxableAmount').value = data.financialSummary.taxableAmount || '';
                    document.getElementById('taxId').value = data.taxId || '';
                    document.getElementById('businessType').value = data.businessType || '';
                }
            } catch (error) {
                showError('uploadResults', error.message);
            }
        }

        // Generate report
        async function generateReport() {
            showLoading('reportResults');

            const data = {
                taxpayerName: document.getElementById('taxpayerName').value,
                taxYear: document.getElementById('taxYear').value,
                totalIncome: document.getElementById('totalIncome').value,
                totalExpenses: document.getElementById('totalExpenses').value,
                totalDeductions: document.getElementById('totalDeductions').value,
                taxableAmount: document.getElementById('taxableAmount').value,
                taxId: document.getElementById('taxId').value,
                businessType: document.getElementById('businessType').value
            };

            try {
                const response = await fetch(`${API_BASE}/api/generate-report`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                showResults('reportResults', result, 'Annual Report');
            } catch (error) {
                showError('reportResults', error.message);
            }
        }

        // Test connection
        async function testConnection() {
            showLoading('testResults');
            
            try {
                const response = await fetch(`${API_BASE}/api/test`);
                const result = await response.json();
                showResults('testResults', result, 'Connection Test');
            } catch (error) {
                showError('testResults', error.message);
            }
        }

        // Check AI status
        async function checkAIStatus() {
            showLoading('testResults');
            
            try {
                const response = await fetch(`${API_BASE}/api/ai-status`);
                const result = await response.json();
                showResults('testResults', result, 'AI Status');
            } catch (error) {
                showError('testResults', error.message);
            }
        }

        // Get server status
        async function getServerStatus() {
            showLoading('testResults');
            
            try {
                const response = await fetch(`${API_BASE}/api/status`);
                const result = await response.json();
                showResults('testResults', result, 'Server Status');
            } catch (error) {
                showError('testResults', error.message);
            }
        }

        // Show loading
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Processing...</p>
                </div>
            `;
        }

        // Show results
        function showResults(elementId, result, title) {
            const isSuccess = result.success;
            const alertClass = isSuccess ? 'alert-success' : 'alert-error';
            
            document.getElementById(elementId).innerHTML = `
                <div class="results">
                    <div class="alert ${alertClass}">
                        <strong>${title} ${isSuccess ? 'Successful' : 'Failed'}</strong>
                    </div>
                    <h3>Response</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                </div>
            `;
        }

        // Show error
        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `
                <div class="results">
                    <div class="alert alert-error">
                        <strong>Error:</strong> ${message}
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html> 